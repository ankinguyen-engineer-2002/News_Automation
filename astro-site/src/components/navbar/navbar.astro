---
import Container from "@/components/container.astro";
import Link from "@/components/ui/link.astro";
import Dropdown from "./dropdown.astro";
import { Astronav, MenuItems, MenuIcon } from "astro-navbar";

const base = import.meta.env.BASE_URL;

const topics = [
  { title: "ðŸ”· Microsoft", slug: "microsoft", desc: "Power BI, Fabric, Azure" },
  { title: "ðŸ”¶ Data Platform", slug: "data-platform", desc: "Databricks, Snowflake, BigQuery" },
  { title: "ðŸŸ¢ Analytics", slug: "analytics-engineering", desc: "dbt, Airflow, Dagster" },
  { title: "ðŸŸ£ AI / LLM", slug: "ai-agents", desc: "OpenAI, Claude, Gemini" },
  { title: "ðŸ”´ Automation", slug: "automation", desc: "n8n, Temporal, CI/CD" },
  { title: "âšª GitHub", slug: "github", desc: "Blog, Changelog, Trending" },
];

const menuitems = [
  {
    title: "Topics",
    path: "#",
    children: topics.map(t => ({
      title: t.title,
      path: `${base}/topics/${t.slug}`,
    })),
  },
  {
    title: "Archive",
    path: `${base}/archive`,
  },
  {
    title: "About",
    path: `${base}/about`,
  },
];
---

<Container>
  <header class="flex flex-col lg:flex-row justify-between items-center my-5">
    <Astronav>
      <div class="flex w-full lg:w-auto items-center justify-between">
        <a href={base || "/"} class="text-lg flex items-center gap-2">
          <span class="text-xl">ðŸ“°</span>
          <span class="font-bold text-slate-800">Daily</span>
          <span class="text-slate-500">Intel</span>
        </a>
        <div class="block lg:hidden">
          <MenuIcon class="w-4 h-4 text-gray-800" />
        </div>
      </div>
      <MenuItems class="hidden w-full lg:w-auto mt-2 lg:flex lg:mt-0">
        <ul class="flex flex-col lg:flex-row lg:gap-3">
          {
            menuitems.map((item, index) => (
              <>
                {item.children && (
                  <Dropdown
                    title={item.title}
                    children={item.children}
                    lastItem={index === menuitems.length - 1}
                  />
                )}

                {!item.children && (
                  <li>
                    <a
                      href={item.path}
                      class="flex lg:px-3 py-2 items-center text-gray-600 hover:text-gray-900">
                      <span>{item.title}</span>
                    </a>
                  </li>
                )}
              </>
            ))
          }
        </ul>
      </MenuItems>
    </Astronav>
    
    <!-- Language Toggle -->
    <div class="hidden lg:flex items-center gap-2">
      <button 
        id="lang-toggle"
        class="px-3 py-1.5 text-sm font-medium bg-slate-100 hover:bg-slate-200 rounded-lg transition flex items-center gap-1.5"
      >
        <span id="lang-label">EN</span>
        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
    </div>
  </header>
</Container>

<script>
  const toggle = document.getElementById('lang-toggle');
  const label = document.getElementById('lang-label');
  
  // Load saved preference
  const savedLang = localStorage.getItem('lang') || 'en';
  document.documentElement.setAttribute('data-lang', savedLang);
  if (label) label.textContent = savedLang.toUpperCase();
  
  toggle?.addEventListener('click', () => {
    const currentLang = document.documentElement.getAttribute('data-lang') || 'en';
    const newLang = currentLang === 'en' ? 'vi' : 'en';
    document.documentElement.setAttribute('data-lang', newLang);
    localStorage.setItem('lang', newLang);
    if (label) label.textContent = newLang.toUpperCase();
    
    // Show/hide content based on language
    document.querySelectorAll('[data-lang-en]').forEach(el => {
      (el as HTMLElement).style.display = newLang === 'en' ? '' : 'none';
    });
    document.querySelectorAll('[data-lang-vi]').forEach(el => {
      (el as HTMLElement).style.display = newLang === 'vi' ? '' : 'none';
    });
  });
</script>
